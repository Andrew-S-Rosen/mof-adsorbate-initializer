# MOF Adsorbate Initializer (MAI)
Python code to add adsorbates to MOFs

Setup
-----
1. Install Python 3.x. If you do not already have Python installed, the easiest option is to download the [Anaconda](https://www.anaconda.com/download/) distribution.
2. Install the most recent versions of Pymatgen and ASE. This can be easily done using `pip install pymatgen ase` 
3. Download or clone the MAI repository and run `pip install .` from the MAI base directory.
4. (recommended) To detect open metal sites (OMSs), download and install [Zeo++](http://www.zeoplusplus.org/download.html) (any version >= 0.3). By default, Zeo++'s OMS detection algorithm does not output a lot of information necessary to add adsorbates to OMSs. To address this, copy `network.cc` from `network/network.cc` and replace the corresponding `network.cc` file in the base directory of Zeo++. The changes can be found starting on line 1165.

Usage
-----
The main use of MAI is to add a single-atom adsorbate or a molecular adsorbate to a given adsorption site on a MOF. Sample scripts are provided in `/examples` that can be used to: 1) add a CH4 adsorbate to an O adsorption site (`add_CH4.py`); 2) add an O adsorbate to an OMS (`add_O.py`); 3) add an H adsorbate to an O adsorption site (`add_H.py`).

The main tool to initialize adsorbate positions is the `adsorbate_constructor`, as described below:
```python
class adsorbate_constructor():
	"""
	This class constructs an ASE atoms object with an adsorbate
	"""
	def __init__(self,ads_species,bond_dist,site_species=None,site_idx=None,
		r_cut=2.5,sum_tol=0.5,rmse_tol=0.25,overlap_tol=0.75):
		"""
		Initialized variables

		Args:
			ads_species (string): string of atomic element for adsorbate
			(e.g. 'O')
			bond_dist (float): distance between adsorbate and surface atom. If
			used with get_adsorbate_raspa, it represents the maximum distance
			for the adsorbate
			site_species (string): string of atomic element for the adsorption
			site species
			site_idx (int): ASE index for the adsorption site (defaults to
			the last element of element type site_species)
			r_cut (float): cutoff distance for calculating nearby atoms when
			ranking adsorption sites
			sum_tol (float): threshold to determine planarity. when the sum
			of the Euclidean distance vectors of coordinating atoms is less
			than sum_tol, planarity is assumed
			rmse_tol (float): second threshold to determine planarity. when the 
			root mean square error of the best-fit plane is less than rmse_tol,
			planarity is assumed
			overlap_tol (float): distance below which atoms are assumed to be
			overlapping
		"""
```
Once the `adsorbate_constructor` is instanced, one of three routines can be called: `get_adsorbate_raspa`, `get_adsorbate_pm`, and `get_adsorbate_zeo_oms`.

The `get_adsorbate_raspa` function is used to add a molecular adsorbate (namely CH4) to the adsorption site of a MOF based on a molecular mechanics energy grid generated by the molecular simulation program [RASPA](https://github.com/numat/RASPA2/), and the CH4 adsorbate is initialized in the lowest energy position within some cutoff distance from the proposed adsorption site. The `get_adsorbate_raspa` function is described below:

```python
def get_adsorbate_raspa(self,atoms_filepath,grid_path=None,
	write_file=True,new_mofs_path=None,error_path=None):
	"""
	This function adds a molecular adsorbate based on an energy grid
	generated using RASPA

	Args:
		atoms_filepath (string): filepath to the structure file (accepts
		CIFs, POSCARs, and CONTCARs)
		grid_path (string): path to the RASPA energy grids
		write_file (bool): if True, the new ASE atoms object should be
		written to a CIF file
		new_mofs_path (string): path to store the new CIF files if
		write_file is True (defaults to atoms_filepath/new_mofs)
		error_path (string): path to store any adsorbates flagged as
		problematic (defaults to atoms_filepath/errors)
	Returns:
		new_atoms (Atoms object): Atoms object of MOF with adsorbate
		new_name (string): name of MOF with adsorbate
	"""
```

**Running RASPA for Generating Energy Grids**

`Todo`

**Running Zeo++ for OMS Detection**

Zeo++ is the recommended method for detecting OMSs in combination with MAI. To use the Zeo++ OMS detection algorithm, one simply has to run `zeo_path -omsex filepath`, where `zeo_path` is the path to `.../zeo++-0.3/network`, `-omsex` requests OMS detection with extended output, and `filepath` is the path to the CIF file of the MOF. This will produce a `.oms` and `.omsex` file for each MOF, which must be stored if MAI is to be used to add adsorbates to the OMSs.
